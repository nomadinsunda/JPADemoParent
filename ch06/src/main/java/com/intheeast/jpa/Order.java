package com.intheeast.jpa;

import lombok.*;

import jakarta.persistence.*;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

@Entity
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@ToString(exclude = "orderItems")
@Table(name = "ORDERS")  // order í‚¤ì›Œë“œëŠ” ì •ë ¬ ê´€ë ¨ ë°ì´í„°ë² ì´ìŠ¤ ì˜ˆì•½ì–´ì„. ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´!
public class Order {

	// One-to-Many ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ë§¤í•‘
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String customerName;

    //ğŸ”¹ë‹¨ë°©í–¥ OneToMany - ì™¸ë˜í‚¤ëŠ” OrderItemì— ì¡´ì¬í•˜ì§€ë§Œ ê´€ë¦¬ ì£¼ì²´ëŠ” Order
    // : ì™¸ë˜í‚¤ëŠ” OrderItem í…Œì´ë¸”ì— ìˆëŠ”ë°, Orderê°€ ê´€ë¦¬ë¥¼ í•˜ê¸° ë•Œë¬¸ì— ì´ ì—°ê´€ ê´€ê³„ëŠ” ëª¨ë‘ê°€ ê·¹í˜í•¨
    //   ì‚¬ìš©í•˜ì§€ ë§ê²ƒ!!!
    @OneToMany(cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY)
    @JoinColumn(name = "order_id") // OrderItem í…Œì´ë¸”ì— FK ìƒì„±
    /*
     create table OrderItem (
       id bigint generated by default as identity,
        productName varchar(255),
        quantity integer not null,
        order_id bigint,
        primary key (id)
     )     
     alter table OrderItem 
       add constraint FK8n4q55qxr4ox0kltr6nb9pa2h 
       foreign key (order_id) 
       references ORDERS
     */
    // @JoinColumn(name = "order_id")ê°€ ì ìš©ëœ í•„ë“œë¡œ ë¶€í„° ì–»ì€ ì •ë³´[List<OrderItem>]ë¡œ,
    // OrderItem í…Œì´ë¸”ì— order_id ì™¸ë˜í‚¤ë¥¼ ë§Œë“¦.
    private final List<OrderItem> orderItems = new ArrayList<>();

    public Order(String customerName) {
        this.customerName = customerName;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
    public void addItem(OrderItem item) {
        orderItems.add(item);
    }
    
    public void removeItem(OrderItem item) {
        orderItems.remove(item);
    }

    public List<OrderItem> getOrderItems() {
        return Collections.unmodifiableList(orderItems); // ì™¸ë¶€ ë³€ê²½ ì°¨ë‹¨
    }
}
